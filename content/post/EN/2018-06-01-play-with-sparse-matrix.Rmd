---
title: Play with Sparse Matrix
author: Yutong Dai
date: '2018-06-01'
lastmod: '2018-06-01'
slug: play-with-sparse-matrix
categories:
  - R-Programming
tags:
  - R-tricks
output:
  blogdown::html_page:
    toc: yes
summary: "Play with sparse matirx using `SparseM`."
---

# Motivation
Recently, I have to deal with matrices with sparsity structures. If I coerce them using the `as.matrix` function, they consume my RAM wildly. So I turn to the package [SparseM](http://www.econ.uiuc.edu/~roger/research/sparse/SparseM.pdf) for possible solutions.

What I want to do are,

1. Performe basic linear algebra operations on sparse matrices, mainly including multiplication, transpose, and etc.
2. Slice rows or columns by their indices.

The package `SparseM` can perfectly fulfill my needs. 

# Solution

```{r}
set.seed(1234)
A <- matrix(rnorm(16), ncol=4, nrow=4)
A[A < 0] <- 0
A
```

We reformat A in `csr` form:

```{r}
suppressMessages(library(SparseM)) 
A.csr <- as.matrix.csr(A)
A.csr
```

> 
> ra: a real array of non-zero elements containing the non-zero elements of A, stored in row order. Thus, if i < j, all elements of row i precede elements from row j. The order of elements within the rows is immaterial.

>ja: an integer array of non-zero elements containing the column indices of the elements stored in ra.

>ia: an integer array of n+1 elements containing pointers to the beginning of each row in the arrays ra and ja. Thus ia[i] indicates the position in the arrays ra and ja where the ith row begins. The last (n + 1)st element of ia indicates where the n + 1 row would start, if it existed.


##  Slicing

```{r}
A.csr[,1:2]
```

```{r}
as.matrix(A.csr[,1:2])
```


```{r}
A.csr[, -1]
```

```{r}
as.matrix(A.csr[, -1])
```


## Basic linear algebra operations

```{r}
t(A.csr)
```

```{r}
as.matrix(A.csr %*% c(1,2,3,4))
```

```{r}
A %*% c(1,2,3,4)
```


We can even visualize its sparse structure:
```{r}
set.seed(1234)
A <- matrix(rnorm(2000), ncol=50, nrow=40)
A[abs(A) < 0.7] <- 0
image(as.matrix.csr(A))
```
